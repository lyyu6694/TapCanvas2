# é£ç‰› NAS éƒ¨ç½²æ¸…å•

æ‰“å°æ­¤æ¸…å•ï¼Œå®Œæˆæ—¶æ‰“å‹¾ âœ…

---

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### åŸºç¡€ç¯å¢ƒæ£€æŸ¥
- [ ] é£ç‰› NAS å·²è¿æ¥ç”µæºå’Œç½‘ç»œ
- [ ] çŸ¥é“ NAS çš„ IP åœ°å€ï¼ˆå¦‚ 192.168.1.100ï¼‰
- [ ] çŸ¥é“ NAS ç®¡ç†å‘˜å¯†ç 
- [ ] NAS æœ‰è‡³å°‘ 10GB å‰©ä½™å­˜å‚¨ç©ºé—´
- [ ] è¿æ¥çš„æ˜¯æœ‰çº¿ç½‘ç»œï¼ˆæ¨èï¼‰

### é‚®ç®±å‡†å¤‡
- [ ] å·²è·å– 163 é‚®ç®±æˆæƒç 
- [ ] å·²éªŒè¯æˆæƒç æœ‰æ•ˆï¼ˆå¯ç™»å½• 163 é‚®ç®±ï¼‰
- [ ] æˆæƒç å·²å¦¥å–„ä¿å­˜

### é¡¹ç›®æ–‡ä»¶
- [ ] TapCanvas é¡¹ç›®å·²ä¸‹è½½æˆ– clone
- [ ] é¡¹ç›®æ–‡ä»¶å·²ä¸Šä¼ åˆ° NAS
- [ ] `.env.example` æ–‡ä»¶å­˜åœ¨
- [ ] `docker-compose.self-hosted.yml` æ–‡ä»¶å­˜åœ¨
- [ ] `apps/email-relay/` ç›®å½•å®Œæ•´

---

## ğŸš€ éƒ¨ç½²æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šè®¿é—®é£ç‰› NAS
- [ ] æ‰“å¼€æµè§ˆå™¨è¾“å…¥ `http://192.168.1.100:8080`
- [ ] ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•
- [ ] æˆåŠŸè¿›å…¥ç®¡ç†ç•Œé¢

### ç¬¬äºŒæ­¥ï¼šå¯ç”¨ Docker
- [ ] è¿›å…¥åº”ç”¨ä¸­å¿ƒ
- [ ] æœç´¢å¹¶å®‰è£… Docker CE
- [ ] Docker å®‰è£…å®Œæˆ
- [ ] éªŒè¯ Docker å¯ç”¨

```bash
docker --version
docker-compose --version
```

- [ ] ä¸¤ä¸ªå‘½ä»¤éƒ½æ­£å¸¸è¿”å›ç‰ˆæœ¬ä¿¡æ¯

### ç¬¬ä¸‰æ­¥ï¼šå‡†å¤‡é…ç½®æ–‡ä»¶
- [ ] SSH è¿æ¥åˆ° NAS

```bash
ssh admin@192.168.1.100
```

- [ ] è¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd /mnt/docker/tapcanvas
```

- [ ] æ£€æŸ¥é¡¹ç›®æ–‡ä»¶å®Œæ•´

```bash
ls -la
```

- [ ] åˆ›å»ºå¹¶ç¼–è¾‘ `.env` æ–‡ä»¶

```bash
nano .env
```

- [ ] å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š

```env
SMTP_USER=your-email@163.com
SMTP_PASS=your-authorization-code
SMTP_HOST=smtp.163.com
SMTP_PORT=465
SMTP_SECURE=true
VITE_API_URL=http://192.168.1.100:8787
EMAIL_RELAY_PORT=3001
WEB_PORT=5173
API_PORT=8787
```

- [ ] ä¿å­˜æ–‡ä»¶ï¼ˆCtrl+X â†’ Y â†’ Enterï¼‰
- [ ] éªŒè¯æ–‡ä»¶å†…å®¹

```bash
cat .env
```

### ç¬¬å››æ­¥ï¼šæ„å»ºå’Œå¯åŠ¨æœåŠ¡
- [ ] æ„å»ºé‚®ä»¶æœåŠ¡é•œåƒ

```bash
docker-compose -f docker-compose.self-hosted.yml build email-relay
```

- [ ] é•œåƒæ„å»ºæˆåŠŸ
- [ ] å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
docker-compose -f docker-compose.self-hosted.yml up -d
```

- [ ] ç­‰å¾… 30 ç§’ï¼Œè®©æœåŠ¡å¯åŠ¨

```bash
sleep 30
```

- [ ] æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
docker-compose -f docker-compose.self-hosted.yml ps
```

- [ ] æ‰€æœ‰å®¹å™¨æ˜¾ç¤º `Up` çŠ¶æ€

### ç¬¬äº”æ­¥ï¼šéªŒè¯æœåŠ¡
- [ ] æµ‹è¯•é‚®ä»¶æœåŠ¡å¥åº·æ£€æŸ¥

```bash
curl http://localhost:3001/health
```

- [ ] è¿”å› `{"status":"ok","service":"email-relay"}`

- [ ] ä»ç”µè„‘æµ‹è¯•é‚®ä»¶æœåŠ¡ï¼ˆæ›¿æ¢ IP åœ°å€ï¼‰

```bash
curl http://192.168.1.100:3001/health
```

- [ ] æ­£å¸¸è¿”å›

- [ ] æµ‹è¯•å‘é€é‚®ä»¶

```bash
curl -X POST http://localhost:3001/send-code \
  -H "Content-Type: application/json" \
  -d '{
    "to": "your-email@163.com",
    "code": "123456",
    "purpose": "signup"
  }'
```

- [ ] è¿”å›æˆåŠŸæ¶ˆæ¯
- [ ] æ”¶åˆ°æµ‹è¯•é‚®ä»¶
- [ ] é‚®ä»¶å†…å®¹æ­£å¸¸

- [ ] åœ¨æµè§ˆå™¨æ‰“å¼€å‰ç«¯åº”ç”¨

```
http://192.168.1.100:5173
```

- [ ] èƒ½æ­£å¸¸åŠ è½½ç™»å½•é¡µé¢

### ç¬¬å…­æ­¥ï¼šæµ‹è¯•å®Œæ•´æµç¨‹
- [ ] æµ‹è¯•é‚®ç®±æ³¨å†Œ

```bash
curl -X POST http://192.168.1.100:8787/auth/email/signup \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@163.com",
    "password": "TestPass123",
    "code": "123456",
    "name": "Test"
  }'
```

- [ ] è¿”å› JWT token

- [ ] æµ‹è¯•é‚®ç®±ç™»å½•

```bash
curl -X POST http://192.168.1.100:8787/auth/email/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@163.com",
    "password": "TestPass123"
  }'
```

- [ ] æˆåŠŸè¿”å› token

- [ ] åœ¨å‰ç«¯ UI æµ‹è¯•æ³¨å†Œæµç¨‹
- [ ] èƒ½æˆåŠŸæ³¨å†Œæ–°è´¦æˆ·
- [ ] èƒ½æˆåŠŸç™»å½•
- [ ] èƒ½æˆåŠŸç™»å‡º

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¸¸æ£€æŸ¥
- [ ] æ¯å¤©æ£€æŸ¥é‚®ä»¶æœåŠ¡æ˜¯å¦è¿è¡Œ

```bash
docker-compose -f docker-compose.self-hosted.yml ps
```

- [ ] æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—

```bash
docker-compose -f docker-compose.self-hosted.yml logs --tail=50
```

- [ ] å®šæœŸå‘é€æµ‹è¯•é‚®ä»¶éªŒè¯åŠŸèƒ½

### æ¯å‘¨ç»´æŠ¤
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´

```bash
df -h
```

- [ ] æ£€æŸ¥å®¹å™¨èµ„æºå ç”¨

```bash
docker stats
```

- [ ] æŸ¥çœ‹ä¸€å‘¨çš„æ—¥å¿—ï¼Œæ£€æŸ¥å¼‚å¸¸

```bash
docker-compose -f docker-compose.self-hosted.yml logs --since 168h
```

### æ¯æœˆç»´æŠ¤
- [ ] æ›´æ–°é¡¹ç›®ä»£ç ï¼ˆå¦‚æœ‰æ–°ç‰ˆæœ¬ï¼‰
- [ ] é‡æ–°ç”Ÿæˆ 163 æˆæƒç ï¼ˆå¯é€‰å®‰å…¨æªæ–½ï¼‰
- [ ] æ¸…ç†æ—§æ—¥å¿—

```bash
docker-compose -f docker-compose.self-hosted.yml logs --tail=0
```

- [ ] æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨å’Œé•œåƒ

```bash
docker system prune -a
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜æ’æŸ¥æµç¨‹

**é—®é¢˜ 1: æ— æ³•è¿æ¥åˆ° NAS**
- [ ] Ping NAS IP åœ°å€ï¼š`ping 192.168.1.100`
- [ ] æ£€æŸ¥ NAS ç½‘ç»œè¿æ¥
- [ ] æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- [ ] é‡å¯ NAS

**é—®é¢˜ 2: Docker ä¸å¯ç”¨**
- [ ] SSH è¿æ¥åˆ° NAS
- [ ] æ£€æŸ¥ Docker æ˜¯å¦å®‰è£…ï¼š`docker --version`
- [ ] æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œï¼š`systemctl status docker`
- [ ] é‡å¯ Dockerï¼š`systemctl restart docker`

**é—®é¢˜ 3: é‚®ä»¶æ— æ³•å‘é€**
- [ ] æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ SMTP ä¿¡æ¯
- [ ] éªŒè¯ 163 æˆæƒç æ˜¯å¦æ­£ç¡®
- [ ] æŸ¥çœ‹é‚®ä»¶æœåŠ¡æ—¥å¿—ï¼š`docker logs tapcanvas-email-relay`
- [ ] æµ‹è¯• SMTP è¿æ¥ï¼š`telnet smtp.163.com 465`
- [ ] é‡æ–°ç”Ÿæˆ 163 æˆæƒç 

**é—®é¢˜ 4: å®¹å™¨å¯åŠ¨å¤±è´¥**
- [ ] ä¸ä½¿ç”¨ `-d` å¯åŠ¨ï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯ï¼š`docker-compose up`
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´ï¼š`df -h`
- [ ] æ£€æŸ¥ç«¯å£å ç”¨ï¼š`sudo lsof -i :3001`
- [ ] æ¸…ç†ç³»ç»Ÿï¼š`docker system prune -a`

**é—®é¢˜ 5: å‰ç«¯æ— æ³•è®¿é—®**
- [ ] æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œï¼š`docker-compose ps`
- [ ] æŸ¥çœ‹å‰ç«¯æ—¥å¿—ï¼š`docker-compose logs web`
- [ ] æ£€æŸ¥ç«¯å£ï¼š`docker port tapcanvas-web`
- [ ] ä» NAS æœ¬åœ°æµ‹è¯•ï¼š`curl http://localhost:5173`

---

## âœ… éƒ¨ç½²å®Œæˆæ¸…å•

### åŠŸèƒ½éªŒè¯
- [ ] é‚®ä»¶æœåŠ¡å¯è®¿é—®
- [ ] å‰ç«¯ UI å¯åŠ è½½
- [ ] å¯å‘é€å’Œæ¥æ”¶éªŒè¯ç é‚®ä»¶
- [ ] å¯æ³¨å†Œæ–°è´¦æˆ·
- [ ] å¯ç™»å½•è´¦æˆ·
- [ ] å¯é‡ç½®å¯†ç 

### ç³»ç»ŸçŠ¶æ€
- [ ] æ‰€æœ‰å®¹å™¨æ­£å¸¸è¿è¡Œ
- [ ] æ— é”™è¯¯æ—¥å¿—
- [ ] ç£ç›˜ç©ºé—´å……è¶³
- [ ] å†…å­˜ä½¿ç”¨æ­£å¸¸
- [ ] CPU ä½¿ç”¨æ­£å¸¸

### æ–‡æ¡£å’Œå¤‡ä»½
- [ ] å·²ä¿å­˜ NAS ç®¡ç†å‘˜å¯†ç 
- [ ] å·²ä¿å­˜ 163 æˆæƒç ï¼ˆå®‰å…¨ä½ç½®ï¼‰
- [ ] å·²è®°å½• NAS IP åœ°å€
- [ ] å·²å¤‡ä»½é¡¹ç›®é…ç½®æ–‡ä»¶
- [ ] å·²é˜…è¯»å®Œæ•´éƒ¨ç½²æŒ‡å—

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

### æŸ¥çœ‹æ—¥å¿—
```bash
docker-compose -f docker-compose.self-hosted.yml logs -f
```

### æŸ¥çœ‹æ–‡æ¡£
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](../QUICK_START.md)
- [å®Œæ•´éƒ¨ç½²æŒ‡å—](./SELF_HOSTED_DEPLOYMENT.md)
- [é£ç‰› NAS ä¸“ç”¨æŒ‡å—](./FILENASNAS_DEPLOYMENT_GUIDE.md)

### æµ‹è¯•é‚®ä»¶å‘é€
```bash
curl -X POST http://192.168.1.100:3001/send-code \
  -H "Content-Type: application/json" \
  -d '{"to":"your-email@163.com","code":"123456","purpose":"signup"}'
```

---

## ğŸ‰ æ­å–œï¼

å¦‚æœæ‰€æœ‰é¡¹éƒ½å·²æ‰“å‹¾ï¼Œè¯´æ˜ä½ å·²æˆåŠŸåœ¨é£ç‰› NAS ä¸Šéƒ¨ç½²äº† TapCanvas é‚®ä»¶è®¤è¯ç³»ç»Ÿï¼

**ä¸‹ä¸€æ­¥**:
1. é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰- å¯é€‰
2. é…ç½® HTTPS/SSL - æ¨è
3. é…ç½®åŸŸå - å¯é€‰
4. ç›‘æ§å’Œå¤‡ä»½ - é‡è¦

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸš€

---

**æ‰“å°æ—¥æœŸ**: _____________  
**å®Œæˆæ—¥æœŸ**: _____________  
**ç»´æŠ¤äººå‘˜**: _____________
